<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1.0, user-scalable=no">
<title>ã‚ãã‚ãï¼ã‹ã‘ã–ã‚“ã‚«ãƒ¼ãƒ‰</title>
<style>
  :root {
    --bg: #fdf2e2;
    --card: #ffffff;
    --ink: #5c3c20;
    --accent: #cc4e00;
    --accent-hover: #9a3412;
    --green: #15803d;
    --ring: #f3e5d8;
    --radius: 24px;
    --shadow: 0 8px 32px rgba(0,0,0,.1);
  }
  *{ box-sizing:border-box }
  html,body{ height:100% }
  body{
    margin:0; background:var(--bg); color:var(--ink);
    font-family:"Hiragino Maru Gothic ProN","Yu Gothic",sans-serif;
    -webkit-tap-highlight-color: transparent;
  }

  /* ç”»é¢ã„ã£ã±ã„ï¼ˆdvhå¯¾å¿œï¼‰ */
  .card{
    width:100%;
    height:100vh;         /* fallback */
    height:100dvh;        /* å®Ÿè¡¨ç¤ºé«˜ã• */
    display:grid; grid-template-rows: auto 1fr; /* åˆæœŸã¯ãƒ˜ãƒƒãƒ€ãƒ¼+ã‚¹ãƒ†ãƒ¼ã‚¸ */
    background: var(--card);
    position: relative; /* â˜… è¿½åŠ ï¼šã‚¹ãƒ†ãƒ¼ã‚¸ã‚’çµ¶å¯¾é…ç½®ã®åŸºæº–ã«ã™ã‚‹ */
  }
  .card.playing{ 
    cursor: pointer; 
    grid-template-rows: 0 1fr; /* â˜… è¿½åŠ ï¼šãƒ—ãƒ¬ã‚¤ä¸­ã¯ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’0ã« */
  }
  .card.playing *{ user-select:none; }

  /* --- è¨­å®šï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ï¼‰ --- */
  .header{
    padding: clamp(16px, 3vw, 36px);
    text-align: center;
  }
  .header h1{
    margin: 0 0 clamp(10px, 2vw, 16px);
    font-size: clamp(28px, 4vw, 48px);
    color: var(--accent);
  }
  .group{ margin: clamp(10px, 1.6vw, 16px) 0 clamp(14px, 2vw, 24px); }
  .group h2{
    margin: 0 0 clamp(8px, 1.2vw, 12px);
    font-size: clamp(14px, 1.8vw, 22px);
    color:#8b5e3c; font-weight:700;
  }

  .dan-selector{
    display:grid; grid-template-columns:repeat(3,1fr);
    gap: clamp(8px, 1.2vw, 16px);
    margin-bottom: clamp(6px, 1vw, 12px);
    padding: 0 clamp(4px, 1vw, 12px);
  }
  .dan-actions{
    display:flex; gap: clamp(8px, 1.2vw, 16px);
    justify-content:center; margin-top: clamp(6px, 1vw, 12px);
  }
  .pill-row{
    display:flex; flex-wrap:wrap; gap: clamp(8px, 1.2vw, 16px); justify-content:center;
    padding: 0 clamp(4px, 1vw, 12px);
  }

  .dan-btn,.pill,.mini-pill{
    border:2px solid var(--ring); border-radius:16px;
    background:#fff; color:var(--ink); cursor:pointer; transition:all .2s ease;
  }
  .dan-btn{
    padding: clamp(12px, 2.2vw, 22px) 0;
    font-size: clamp(28px, 4.8vw, 64px); font-weight: 800;
  }
  .pill{
    padding: clamp(10px, 1.8vw, 18px) clamp(14px, 2.4vw, 28px);
    font-size: clamp(18px, 2.6vw, 32px); font-weight: 700;
  }
  .mini-pill{
    padding: clamp(6px, 1.2vw, 10px) clamp(10px, 2vw, 16px);
    font-size: clamp(14px, 1.8vw, 22px); font-weight: 600;
  }
  .dan-btn:hover,.pill:hover,.mini-pill:hover{ background:#fffaf0; transform: translateY(-2px); }
  .selected{ background:var(--accent); color:#fff; border-color:var(--accent); transform:scale(1.05); }

  .btn{
    border:none; border-radius:99px;
    padding: clamp(12px, 2.2vw, 24px) clamp(24px, 4vw, 48px);
    font-size: clamp(22px, 3.2vw, 40px); font-weight: 800;
    background: var(--accent); color:#fff; cursor:pointer; transition: background-color .2s ease;
  }
  .btn:hover{ background: var(--accent-hover); }
  .btn:disabled{ opacity:.5; cursor:not-allowed }

  /* --- å•é¡Œï¼ˆä¸­å¤®ã‚¹ãƒ†ãƒ¼ã‚¸ï¼šå…¨é¢ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼†ä¸­å¤®æƒãˆï¼‰ --- */
  .stage{
    position: absolute;    /* â˜… å¤‰æ›´ */
    inset: 0;              /* â˜… å¤‰æ›´ï¼šä¸Šä¸‹å·¦å³0ã§å…¨é¢ */
    display: grid;         /* â˜… å¤‰æ›´ */
    place-items: center;   /* â˜… å¤‰æ›´ï¼šç¸¦æ¨ªä¸­å¤® */
    padding: clamp(16px, 3vw, 36px);
  }
  .eq{
    display:flex; align-items:center; justify-content:center;
    gap: clamp(16px, 4vw, 48px);
    font-weight: 900; line-height: 1.1;
  }
  .piece{ font-size: clamp(80px, 16vw, 260px); }
  .ans{
    font-size: clamp(80px, 16vw, 260px);
    color: var(--green);
    visibility:hidden; transform: scale(0.5); opacity:0;
    transition: all .3s cubic-bezier(0.34,1.56,0.64,1);
  }
  .ans.show{ visibility:visible; transform: scale(1); opacity:1; }

  .hidden{ display:none; }
</style>
</head>
<body>
  <main class="card" role="application">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <section class="header" id="header">
      <h1>ã‹ã‘ã–ã‚“ã‚Œã‚“ã—ã‚…ã†</h1>

      <div class="group">
        <h2>ã ã‚“ ã‚’ãˆã‚‰ã¶ï¼ˆãªã‚“ã“ã§ã‚‚OKï¼‰</h2>
        <div class="dan-selector" id="dan-selector"></div>
        <div class="dan-actions">
          <button class="mini-pill" id="select-all">ãœã‚“ã¶</button>
          <button class="mini-pill" id="clear-all">ã‚¯ãƒªã‚¢</button>
        </div>
      </div>

      <div class="group">
        <h2>ã—ã‚…ã¤ã ã„ã˜ã‚…ã‚“</h2>
        <div class="pill-row" id="mode-row">
          <button class="pill selected" data-mode="rand">ãƒ©ãƒ³ãƒ€ãƒ </button>
          <button class="pill" data-mode="seq">ã˜ã‚…ã‚“ã°ã‚“</button>
        </div>
      </div>

      <div class="group">
        <h2>ã‚‚ã‚“ã ã„ã™ã†</h2>
        <div class="pill-row" id="count-row">
          <button class="pill" data-count="9">9</button>
          <button class="pill selected" data-count="18">18</button>
          <button class="pill" data-count="27">27</button>
          <button class="pill" data-count="36">36</button>
          <button class="pill" data-count="45">45</button>
          <button class="pill" data-count="54">54</button>
          <button class="pill" data-count="63">63</button>
          <button class="pill" data-count="72">72</button>
          <button class="pill" data-count="81">81</button>
        </div>
      </div>

      <button class="btn" id="start" disabled>ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
    </section>

    <!-- ã‚¹ãƒ†ãƒ¼ã‚¸ï¼ˆä¸­å¤®ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰ï¼‰ -->
    <section class="stage hidden" id="stage" aria-live="polite">
      <div class="eq" id="eq">
        <span class="piece" id="L"></span>
        <span class="piece" id="X">Ã—</span>
        <span class="piece" id="R"></span>
        <span class="piece" id="E">=</span>
        <span class="ans"   id="A"></span>
      </div>
    </section>
  </main>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  // ç”»é¢
  const card   = document.querySelector('.card');
  const header = $('header');
  const stage  = $('stage');

  // è¨­å®šUI
  const danSelector  = $('dan-selector');
  const selectAllBtn = $('select-all');
  const clearAllBtn  = $('clear-all');
  const modeRow      = $('mode-row');
  const countRow     = $('count-row');
  const startBtn     = $('start');

  // å¼
  let L = $('L'), X = $('X'), R = $('R'), E = $('E'), A = $('A');

  // çŠ¶æ…‹
  let problems = [];
  let idx = 0;
  let showingAnswer = false;
  let running = false;
  let selectedDans = [];
  let selectedMode = 'rand';   // 'rand' | 'seq'
  let selectedCount = 18;      // 9..81 (9åˆ»ã¿)

  // æ®µãƒœã‚¿ãƒ³ï¼ˆ1ã€œ9ï¼‰
  for (let i = 1; i <= 9; i++) {
    const btn = document.createElement('button');
    btn.className = 'dan-btn';
    btn.textContent = i;
    btn.dataset.dan = i;
    danSelector.appendChild(btn);
  }

  function refreshSelectedDans(){
    selectedDans = Array.from(danSelector.querySelectorAll('.dan-btn.selected'))
      .map(b => parseInt(b.dataset.dan, 10))
      .sort((a,b)=>a-b);
    startBtn.disabled = selectedDans.length === 0;
  }

  // æ®µãƒˆã‚°ãƒ«
  danSelector.addEventListener('click', (e) => {
    const btn = e.target.closest('.dan-btn');
    if (!btn) return;
    btn.classList.toggle('selected');
    refreshSelectedDans();
  });

  // ãœã‚“ã¶ / ã‚¯ãƒªã‚¢
  selectAllBtn.addEventListener('click', () => {
    danSelector.querySelectorAll('.dan-btn').forEach(b => b.classList.add('selected'));
    refreshSelectedDans();
  });
  clearAllBtn.addEventListener('click', () => {
    danSelector.querySelectorAll('.dan-btn').forEach(b => b.classList.remove('selected'));
    refreshSelectedDans();
  });

  // å‡ºé¡Œé †
  modeRow.addEventListener('click', (e) => {
    const b = e.target.closest('.pill'); if (!b) return;
    modeRow.querySelectorAll('.pill').forEach(p=>p.classList.remove('selected'));
    b.classList.add('selected');
    selectedMode = b.dataset.mode; // 'rand' | 'seq'
  });

  // å•é¡Œæ•°
  countRow.addEventListener('click', (e) => {
    const b = e.target.closest('.pill'); if (!b) return;
    countRow.querySelectorAll('.pill').forEach(p=>p.classList.remove('selected'));
    b.classList.add('selected');
    selectedCount = parseInt(b.dataset.count, 10);
  });

  // å•é¡Œç”Ÿæˆ
  function createProblems(dans, count, mode) {
    const list = [];
    if (mode === 'seq') {
      const onePass = [];
      for (const d of [...dans].sort((a,b)=>a-b)) {
        for (let r = 1; r <= 9; r++) onePass.push([d, r]);
      }
      while (list.length < count) list.push(...onePass);
      list.length = count;
    } else {
      for (let i = 0; i < count; i++) {
        const d = dans[Math.floor(Math.random()*dans.length)];
        const r = Math.floor(Math.random()*9) + 1;
        list.push([d, r]);
      }
    }
    return list;
  }

  // è¡¨ç¤º
  function showProblem() {
    const [l, r] = problems[idx];
    L.textContent = String(l);
    R.textContent = String(r);
    A.textContent = String(l * r);
    A.classList.remove('show');
    showingAnswer = false;
  }
  function showAnswer() {
    A.classList.add('show');
    showingAnswer = true;
  }
  function nextProblem() {
    if (idx < problems.length - 1) { idx++; showProblem(); }
    else { finishGame(); }
  }

  // é–‹å§‹ãƒ»çµ‚äº†
  function startGame() {
    problems = createProblems(selectedDans, selectedCount, selectedMode);
    idx = 0; running = true;

    header.classList.add('hidden');
    stage.classList.remove('hidden');
    card.classList.add('playing'); // â˜… ãƒ—ãƒ¬ã‚¤ä¸­ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆé©ç”¨

    showProblem();
  }

  function finishGame() {
    running = false;
    card.classList.remove('playing');
    stage.innerHTML = `
      <div class="done" role="status" style="text-align:center;">
        <div class="done-icon" style="font-size: clamp(48px, 8vw, 100px); margin-bottom: 12px;">ğŸ…</div>
        <h2 style="font-size: clamp(28px, 4vw, 56px); color: var(--accent); margin: 0 0 8px;">ã‚ˆãã§ãã¾ã—ãŸï¼</h2>
        <p style="font-size: clamp(18px, 2.4vw, 28px); margin: 0 0 16px;">
          ${selectedDans.join('ãƒ»')} ã®ã ã‚“ã‚’ ${problems.length}ã‚‚ã‚“ ãŒã‚“ã°ã£ãŸã­ï¼
        </p>
        <div class="row" style="display:flex; gap: clamp(10px, 2vw, 18px); justify-content:center;">
          <button class="btn ghost" id="again" style="background:#f0e6da; color:var(--ink);">
            ã‚‚ã†ã„ã£ã‹ã„
          </button>
          <button class="btn" id="reset">ã‚‚ã©ã‚‹</button>
        </div>
      </div>
    `;

    $('again').onclick = () => {
      stage.innerHTML = `
        <div class="eq" id="eq">
          <span class="piece" id="L"></span><span class="piece" id="X">Ã—</span>
          <span class="piece" id="R"></span><span class="piece" id="E">=</span>
          <span class="ans" id="A"></span>
        </div>
      `;
      L = $('L'); X = $('X'); R = $('R'); E = $('E'); A = $('A');
      startGame();
    };
    $('reset').onclick = () => location.reload();
  }

  // å…¨ç”»é¢ã‚¿ãƒƒãƒ—ï¼š1å›ã§ç­”ãˆã€ã‚‚ã†1å›ã§æ¬¡ã¸
  card.addEventListener('click', (e) => {
    if (!running) return;
    if (e.target.closest('button')) return;
    if (!showingAnswer) showAnswer(); else nextProblem();
  });

  // æ“ä½œ
  startBtn.addEventListener('click', () => { if (selectedDans.length) startGame(); });
})();
</script>
</body>
</html>
